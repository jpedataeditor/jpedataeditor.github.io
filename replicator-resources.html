<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Replicator Resources ‚Äì JPE Data Editor</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./img/jpeicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-79108a0fc1995748cbd19a5b0e3e3e7c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Replicator Resources</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This page contains tips and tricks for replicators.</p>
<section id="rules-of-behaviour" class="level1">
<h1>Rules of Behaviour</h1>
<ol type="1">
<li>Never contact an author without explicit instruction of the data editor. This serves mainly to protect your own privacy.</li>
<li>If you find some inconsistencies between package output and paper content, don‚Äôt stop at saying for example ‚Äútable 3 does not correspond‚Äù. Make sure to point out <em>in which way</em> it does not correspond; The fact that it does not seem to correspond on your computer does not necessarily mean that it does not correspond on the author‚Äôs computer as well (see <a href="#environments">below on environments</a>).</li>
<li>In your report, make good use of textual output from package (like produced tables) and output in paper side by side which does not correspond. Same holds for figures (best to include as screenshots).</li>
<li>In your report, try to adopt a pleasant and forthcoming tone of language, it will make any interaction easier.</li>
</ol>
</section>
<section id="important-things-to-look-our-for" class="level1">
<h1>Important Things to Look Our For üßê</h1>
<section id="hard-coded-numbers" class="level2">
<h2 class="anchored" data-anchor-id="hard-coded-numbers">Hard Coded Numbers</h2>
<ul>
<li><p>Without proper documentation of how they were obtained, hard coded numbers are not admissible in code that generates results like plots or tables.</p></li>
<li><p>Plots are particularly critical here.</p></li>
<li><p>A fairly quick part of your work should be a scan of all source code to identify hard coded numbers and make sure everything is proper with those.</p></li>
<li><p>Here is an example which triggers our suspicion: The below code is used to make a bar chart. However, the heights of the bars are hard coded as numbers. If it is not obvious where the numbers come from, then this fact should be a prominent feature in your report.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/replicators-hardcode.png" class="img-fluid figure-img"></p>
<figcaption>hard coded numbers in code for a plot (python)</figcaption>
</figure>
</div></li>
</ul>
<section id="how-to-find-hard-coded-numbers" class="level3">
<h3 class="anchored" data-anchor-id="how-to-find-hard-coded-numbers">How to find hard coded numbers?</h3>
<p>Regular expressions (Regex) are the perfect tool for this. I recommend opening the full replication package in VScode. Here is an example. You can download the example package as usual from our dropbox at <code>EJ-2-submitted-replication-packages/Oswald-123456-R1</code>.</p>
<ol type="1">
<li><p>Open Package in VScode</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/replicators-hardcode2.png" class="img-fluid figure-img"></p>
<figcaption>opening full replication package in VScode</figcaption>
</figure>
</div></li>
<li><p>Next, activate the search function, either by clicking or by typing <code>Cmd+Shift+F</code>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/replicators-hardcode3.png" class="img-fluid figure-img"></p>
<figcaption>activating search in entire project</figcaption>
</figure>
</div></li>
<li><p>Make sure to turn on <em>regex</em> search by clicking the symbol <code>.*</code> in the right of the search text box. Now you can enter <em>regex</em> search terms. Here, I‚Äôm entering <code>\d</code> for <em>digits</em> (i.e.&nbsp;<em>numbers</em>), and I‚Äôm saying <code>{3,10}</code> to instruct the search to look for sequences of numbers with length in between 3 and 10. That is, numbers ranging from 3 up to 10 digits. You can change that of course. Notice how the search returns immediately all occurences of such numbers in the project.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/replicators-hardcode4.png" class="img-fluid figure-img"></p>
<figcaption>using regex search to look for numbers between 3 and 10 digits long. <code>plots.jl</code> seems to contain hard coded numbers as source code.</figcaption>
</figure>
</div></li>
<li><p>Finally, look whether any of those numbers do appear in a code file. Here, the <code>plots.jl</code> seems to be suspicious. Double click on a particular search results opens the relevant source file. Gotcha!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/replicators-hardcode5.png" class="img-fluid figure-img"></p>
<figcaption>Example of hard coded numbers to generate a plot. Unless the origin and reproducibililty of those numbers is clearly documented <em>in the readme and in the source code</em>, this is not admissible.</figcaption>
</figure>
</div></li>
</ol>
</section>
</section>
<section id="missing-software-libraries-in-readme" class="level2">
<h2 class="anchored" data-anchor-id="missing-software-libraries-in-readme">Missing Software Libraries in <code>README</code></h2>
<ul>
<li>It is very common that authors forget to list all required software libraries, or do not list the version information that goes with those libraries.</li>
<li>Best practice would be to use an <em>empty system</em> where <em>no libraries are pre-installed</em>. The <em>nuvolos</em> platform is helpful here, because this is the case there.</li>
</ul>
</section>
</section>
<section id="environments" class="level1">
<h1>Environments</h1>
<ul>
<li>What is an environment?</li>
<li>Why does my code not work on your computer?</li>
</ul>
<section id="python" class="level2">
<h2 class="anchored" data-anchor-id="python"><code>python</code></h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Where to get <code>python</code>?
</div>
</div>
<div class="callout-body-container callout-body">
<p>First things first. How can you get <code>python</code> on your computer? I <strong>strongly recommend</strong> the <a href="https://conda.io/projects/conda/en/latest/index.html">conda</a> distribution - please follow instructions to install. This is what is available on <code>nuvolos</code> (i.e.&nbsp;nothing to do for python on nuvolos, it‚Äôs there.)</p>
</div>
</div>
<p>Next, on to our case study. An author says:</p>
<blockquote class="blockquote">
<p>We use python. You must install the <code>networkx</code> package from pip. The rest of the packages is standard.</p>
</blockquote>
<p>This is an incomplete specification on various counts.</p>
<ol type="1">
<li>We must know which <code>python</code> version to use. There are many.</li>
<li>We cannot work with <em>the rest of the packages is standard</em>. There is no notion of <em>standard</em> in this setting.</li>
<li>Installing via <code>pip</code> for instance depends on which particular <code>python</code> version is installed, and how that particular version of <code>networkx</code> relates to those <em>standard</em> packages mentioned above.</li>
</ol>
<p>üëâ It is highly likely that following those instructions, we end up with a vastly different set of package (and base <code>python</code>!) versions than what the authors used on their machine.</p>
<p>üëâ Not good, because this alone could lead to diverging results and/or errors.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution: Virtual Environments
</div>
</div>
<div class="callout-body-container callout-body">
<p>Easiest with <code>anaconda</code> on <code>nuvolos</code> or your own machine, but base python also has a solution.</p>
<ul>
<li><a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">conda solution</a></li>
<li><a href="https://docs.python.org/3/library/venv.html">base python solution</a></li>
</ul>
<p>I recommend the <code>conda</code> route.</p>
</div>
</div>
<p>Let‚Äôs solve this particular case. We will create a virtual environment for ourselves, making some assumptions along the way. We can at least communicate with the authors on that assumed basis. Therefore, we open <code>VScode</code> and look at the notebook file (notice this is much quicker than opening a <code>jupyterlab</code> session). We note that in the first code box they <code>import</code> the required libraries. We want to have an environment containing those packages.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/condaenv1.png" class="img-fluid figure-img"></p>
<figcaption>Opening a jupyter notebook in VSCode to see package dependencies</figcaption>
</figure>
</div>
<p>There are two ways to create an environment: on the command line or by writing a <code>.yml</code> file.</p>
<section id="creating-a-conda-env-on-the-command-line" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-conda-env-on-the-command-line">Creating a <code>conda env</code> on the command line</h3>
<p>This is easy.</p>
<ol type="1">
<li><p>Open a terminal in VScode via the command palette (type shift-cmd-p or click cogwheel bottom left). In the command palette type <code>create new terminal</code> and hit enter.</p></li>
<li><p>In the terminal window create the new environment, maybe called with the author‚Äôs name, specifying all required versions, as well as an assumed python version:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creates new virtual env called `author-name`</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># notice that the nuvolos terminal runs conda by default and tells</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># you that your are in the (base) environment now:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">11:35:56</span> <span class="at">-</span> nuvolos:/files$ conda create <span class="at">-n</span> author-name python=3.11 matplotlib pandas numpy networkx seaborn scipy  </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Channels:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">-</span> defaults</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a> <span class="ex">-</span> conda-forge</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Platform:</span> linux-64</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Collecting</span> package metadata <span class="er">(</span><span class="ex">repodata.json</span><span class="kw">)</span><span class="bu">:</span> done</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Solving</span> environment: <span class="at">-</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>hit <code>y</code> when asked whether to install packages:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Downloading</span> and Extracting Packages:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Preparing</span> transaction: done                                                                 </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Verifying</span> transaction: done                                                       </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Executing</span> transaction: done</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                          </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># To activate this environment, use</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                              </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     $ conda activate author-name                                                          </span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                                       </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># To deactivate an active environment, use</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                                        </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     $ conda deactivate </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>After it‚Äôs done, we can <code>activate</code> that environment. Notice the prompt switching to the new env.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">11:40:14</span> <span class="at">-</span> nuvolos:/files$ conda activate author-name                                                                                                       </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">author-name</span><span class="kw">)</span> <span class="ex">11:41:42</span> <span class="at">-</span> nuvolos:/files$             </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From that point on, we are <em>sure</em> what versions are being used when we say <code>import networkx</code>, for example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">author-name</span><span class="kw">)</span> <span class="ex">11:41:42</span> <span class="at">-</span> nuvolos:/files$ python <span class="at">--version</span>      </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Python</span> 3.11.9  <span class="co"># we *asked* for that version!</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">author-name</span><span class="kw">)</span> <span class="ex">11:42:20</span> <span class="at">-</span> nuvolos:/files$ python</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Python</span> 3.11.9 <span class="er">(</span><span class="ex">main,</span> Apr 19 2024, 16:48:06<span class="kw">)</span> <span class="ex">[GCC</span> 11.2.0] on linux</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Type</span> <span class="st">"help"</span>, <span class="st">"copyright"</span>, <span class="st">"credits"</span> or <span class="st">"license"</span> for more information.</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> import <span class="ex">networkx</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> print<span class="kw">(</span><span class="ex">networkx.__version__</span><span class="kw">)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="ex">3.3</span>   <span class="co"># that is default version compatible with our env</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So, we are now using <code>python</code> 3.11.9 and <code>networkx</code> 3.3.</p></li>
<li><p>Oftentimes, authors supply jupyter notebooks (as in the present case). We need a way to run those <em>inside</em> our environment. So, we also install a notebook runner, while we are in the activated env:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install Python kernel in new conda env</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">author-name</span><span class="kw">)</span> <span class="ex">11:42:20</span> <span class="at">-</span> nuvolos:/files$ conda install ipykernel</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># configure new notebook kernel</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">author-name</span><span class="kw">)</span> <span class="ex">11:42:20</span> <span class="at">-</span> nuvolos:/files$ ipython kernel install <span class="at">--user</span> <span class="at">--name</span><span class="op">=</span>author-kernel   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Now we can <code>select kernel</code> in the notebook view, i.e.&nbsp;we will choose the python engine which goes together with this particular environment.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/condaenv2.png" class="img-fluid figure-img"></p>
<figcaption>Selecting a Kernel from a <code>python</code> environment</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/condaenv3.png" class="img-fluid figure-img"></p>
<figcaption>choose our created <code>author-name</code> environment</figcaption>
</figure>
</div></li>
<li><p>Clicking on the ‚ñ∂Ô∏è button left of each cell, we can run the contained code. Here I added two code cells to print python and <code>networkx</code> package versions.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/condaenv4.png" class="img-fluid figure-img"></p>
<figcaption>executing code in notebook using our environment. Notice that python and networkx versions correspond to our specs above.</figcaption>
</figure>
</div></li>
</ol>
<p>The preceding steps of starting a notebook - from the external drive <code>/space_mounts</code> is illustrated in this video:</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/4-Pdk3AAxDs" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<section id="creating-a-conda-env-via-a-.yml-file" class="level4">
<h4 class="anchored" data-anchor-id="creating-a-conda-env-via-a-.yml-file">Creating a <code>conda env</code> via a <code>.yml</code> file</h4>
<p>We could have equally well created a full <em>recipe</em> file, from which to build this environment. This may be useful to share with authors. You would save that as <code>author-env.yml</code> for instance:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">name:</span> author-name</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">dependencies:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> python=3.11</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> matplotlib</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> seaborn</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> netwworkx</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> pandas</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> numpy</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> scipy</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> ipykernel</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> pip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, one can create the env via</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">-f</span> author-env.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="creating-a-conda-env-from-a-supplie-.yml-file" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-conda-env-from-a-supplie-.yml-file">Creating a <code>conda env</code> from a supplie <code>.yml</code> file</h3>
<p>Some authors actually give us such a file! In this case, the same applies:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">11:49:15</span> <span class="at">-</span> nuvolos:/files$ conda env create <span class="at">-f</span> /files/Replication_package_Agostini_Bloise_Tancioni/DML_python/environment.yml</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># To activate this environment, use</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     $ conda activate ectj_abt</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># To deactivate an active environment, use</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     $ conda deactivate</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">09:52:23</span> <span class="at">-</span> nuvolos:/files/Replication_package$ conda activate ectj_abt</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">ectj_abt</span><span class="kw">)</span> <span class="ex">09:55:17</span> <span class="at">-</span> nuvolos:/files/Replication_package$ python <span class="at">--version</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Python</span> 3.9.7</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">ectj_abt</span><span class="kw">)</span> <span class="ex">09:55:31</span> <span class="at">-</span> nuvolos:/files/Replication_package$ python Main.py</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Conda</span> environment ectj_abt already exists. Skipping creation.</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> the estimation for dml_JJ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Enforce Best Practice
</div>
</div>
<div class="callout-body-container callout-body">
<p>If a python package does <em>not</em> contain a virtual environment, you <strong>must</strong> recommend the authors to add this in your report.</p>
</div>
</div>
</section>
</section>
<section id="stata" class="level2">
<h2 class="anchored" data-anchor-id="stata"><code>stata</code></h2>
<p>There is an excellent guide for how to lock in add-on stata packages into a certain state. By default, there is no mechanism in stata which would version add-on packages (the user is responsible to install the <em>correct</em> version - which may be extremely difficult in practice because older versions may no longer be retrievable).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stata Library Guide
</div>
</div>
<div class="callout-body-container callout-body">
<p>The relevant guide is by Julian Reif and accessible <a href="https://julianreif.com/guide/#libraries">here</a>.</p>
</div>
</div>
</section>
<section id="julia" class="level2">
<h2 class="anchored" data-anchor-id="julia"><code>julia</code></h2>
<p>Environment creating is built-in with base julia in the package manager. In any given directory, type <code>]</code> to enter <code>Pkg</code> mode. Here we create an environment at the current directory <code>.</code> and add two packages. The resulting files <code>Project.toml</code> and <code>Manifest.toml</code> encode the exact versions of all component packages (i.e.&nbsp;including dependencies of the packages we are asking for). Any user can use those 2 files to recreate the exact same software environment as the author.</p>
<pre><code>(@v1.10) pkg&gt; activate .
  Activating new project at `~/replications/Oswald-123456/full-package/3-replication-package`

(3-replication-package) pkg&gt; add GLM DataFrames
   Resolving package versions...
   Installed LogExpFunctions ‚îÄ v0.3.28
   Installed Distributions ‚îÄ‚îÄ‚îÄ v0.25.109
    Updating `~/replications/Oswald-123456/full-package/3-replication-package/Project.toml`
  [a93c6f00] + DataFrames v1.6.1
  [38e38edf] + GLM v1.9.0
    Updating `~/replications/Oswald-123456/full-package/3-replication-package/Manifest.toml`
</code></pre>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
No <code>julia</code> without <code>Project.toml</code>!
</div>
</div>
<div class="callout-body-container callout-body">
<p>We <strong>require</strong> at least a <code>Project.toml</code> for <em>any</em> <code>julia</code> project. We <em>strongly recommend</em> supplying also a <code>Manifest.toml</code> from the authors.</p>
</div>
</div>
</section>
</section>
<section id="data-citations-for-exeriments" class="level1">
<h1>Data Citations for exeriments</h1>
<p>If you generate your own data via an experiment, of course you cannot cite it. If you use data from a previously published experiment, you could cite it. So: no, you don‚Äôt need either citation or a DAS if you use exclusively your own generated data. You do not need the zenodo DOI. you will obtain this at the very end of the process, so that people (including yourselves) can cite your package (including generated data) in the future.</p>
</section>
<section id="working-on-nuvolos" class="level1">
<h1>Working on Nuvolos</h1>
<blockquote class="blockquote">
<p>Ask the Data Editor to create a new instance for you.</p>
</blockquote>
<section id="memory-consumption" class="level2">
<h2 class="anchored" data-anchor-id="memory-consumption">Memory Consumption</h2>
<ul>
<li>Nuvolos (and any shared resource like a HPC system) will strictly enforce memory (RAM) limits.</li>
<li>If your app consumes more than what is available, the app will be killed. You will not get an error message in most cases, but your app will just freeze or shut down.</li>
<li>You can increase the size (CPU + RAM) by clicking on the cogwheel next to the apps start button in the ‚ÄúApplications‚Äù view.</li>
</ul>
<p><img src="img/nuvolos-memory1.png" class="img-fluid"></p>
</section>
<section id="large-files-on-nuvolos" class="level2">
<h2 class="anchored" data-anchor-id="large-files-on-nuvolos">large files on nuvolos</h2>
<p>You can try the web-based uploader which will take any URL directly:</p>
<p><img src="img/nuvolos-large-upload.png" class="img-fluid"></p>
<p>When copying the dropbox URL, remember to change ‚Äòdl=0‚Äô to ‚Äòdl=1‚Äô inside the URL. This forces the download. For example:</p>
<pre><code>https://www.dropbox.com/scl/fo/gumryf1zs8lwk5zq5udo7/ABrnRWk5w859IIib/Author-YYYYMMDD-R1?*dl=1*</code></pre>
<p>To rename the file, open the terminal and write</p>
<pre><code>mv 'old_file_name' 'new_file_name'</code></pre>
<p>If the file is very large, move it to the ‚Äòlarge file storage‚Äô that you can create in the ‚ÄòProject Configuration‚Äô tab on Nuvolos.</p>
<pre><code>(base) nuvolos@nuvolos:/files$ ls
'old_file_name' 'some_folder'
(base) nuvolos@nuvolos:/files$ mv 'old_file_name' 'new_file_name.zip'
(base) nuvolos@nuvolos:/files$ mv 'new_file_name.zip' /space_mounts/mount_name/</code></pre>
<p>For very large files, however, this does not work well and you need to use the <a href="https://docs.nuvolos.cloud/features/file-system-and-storage/mount-dropbox">dropbox sync integration</a>. This will map a specific folder in your dropbox onto your nuvolos instance at <code>/dropbox</code></p>
</section>
</section>
<section id="r-gotchas" class="level1">
<h1><code>R</code> gotchas</h1>
<section id="the-grf-random-forests-package" class="level2">
<h2 class="anchored" data-anchor-id="the-grf-random-forests-package">The <code>grf</code> Random Forests Package</h2>
<p>There is a well-documented problem with cross platform compatibility. Only a certain setting of the <code>regression_forest</code> command will reproduce results across different platforms. The setting concerns the arguments <code>num.threads</code> and <code>seed</code>. Please make sure those are set. Reference <a href="https://grf-labs.github.io/grf/REFERENCE.html#forests-predict-different-values-depending-on-the-platform-even-though-the-seed-is-the-same">here</a> and example <a href="https://github.com/grf-labs/grf/issues/793">issue here</a></p>
</section>
<section id="sharing-full-r-libraries-does-not-work-in-general" class="level2">
<h2 class="anchored" data-anchor-id="sharing-full-r-libraries-does-not-work-in-general">Sharing Full <code>R</code> Libraries does not work in general</h2>
<ul>
<li>you cannot just include your direct dependencies in an R package and hope that just works.</li>
<li>By the way, <code>R</code> package need to be <em>installed</em> via a specific process (<code>install.packages</code>); it is <em>not</em> possible to copy a package directly into the local library location. For instance, for me this is</li>
</ul>
<pre><code>&gt; .libPaths()
[1] "/Users/floswald/Library/R/arm64/4.2/library"                         
[2] "/Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/library"</code></pre>
<p>If an author provides me with a set of libraries by just copying them out of <em>their</em> <code>libPaths()</code> and into the package, so that we could use them, this will <em>only work under certain conditions</em>; The OS and underlying compiler infrastructure need to be identical, for example. Simply put, if the author used MacOS 13.4.1, this will not work an any windows machine. It will most likely not work on any other MacOS either.</p>
<blockquote class="blockquote">
<p>R package installation may use system libraries and tools in order to <strong>build</strong> the package <em>for your system</em>. Most packages are pre-built binaries which just download and plug in, but some are not. This is particularly true for older versions, for which binaries are no long available.</p>
</blockquote>
<ul>
<li>you will miss upstream dependencies. RcppEigen was not provided here.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">"HDLPrepro_1.12.tar.gz"</span>, <span class="at">repos =</span> <span class="cn">NULL</span>, <span class="at">type =</span> <span class="st">"source"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Installing package into ‚Äò<span class="sc">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>lib<span class="sc">/</span>R<span class="sc">/</span>site<span class="sc">-</span>library‚Äô</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>(as ‚Äòlib‚Äô is unspecified)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>ERROR<span class="sc">:</span> dependencies ‚Äòbigtime‚Äô, ‚Äòdesla‚Äô, ‚Äòggpubr‚Äô, ‚Äòrrpack‚Äô, ‚ÄòtsDyn‚Äô, ‚Äòvars‚Äô, ‚ÄòRcppProgress‚Äô, ‚Äòsitmo‚Äô are not available <span class="cf">for</span> package ‚ÄòHDLPrepro‚Äô</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> removing ‚Äò<span class="sc">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>lib<span class="sc">/</span>R<span class="sc">/</span>site<span class="sc">-</span>library<span class="sc">/</span>HDLPrepro‚Äô</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>Warning <span class="cf">in</span> install.packages <span class="sc">:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  installation of package ‚ÄòHDLPrepro_1.<span class="fl">12.</span>tar.gz‚Äô had non<span class="sc">-</span>zero exit status</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">install.packages</span>(<span class="st">"Backup copies of other packages/bigtime_0.2.2.tar.gz"</span>, <span class="at">repos =</span> <span class="cn">NULL</span>, <span class="at">type =</span> <span class="st">"source"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>Installing package into ‚Äò<span class="sc">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>lib<span class="sc">/</span>R<span class="sc">/</span>site<span class="sc">-</span>library‚Äô</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>(as ‚Äòlib‚Äô is unspecified)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>ERROR<span class="sc">:</span> dependencies ‚Äòcorrplot‚Äô, ‚ÄòRcppEigen‚Äô are not available <span class="cf">for</span> package ‚Äòbigtime‚Äô</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> removing ‚Äò<span class="sc">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>lib<span class="sc">/</span>R<span class="sc">/</span>site<span class="sc">-</span>library<span class="sc">/</span>bigtime‚Äô</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>Warning <span class="cf">in</span> install.packages <span class="sc">:</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  installation of package ‚ÄòBackup copies of other packages<span class="sc">/</span>bigtime_0.<span class="dv">2</span>.<span class="fl">2.</span>tar.gz‚Äô had non<span class="sc">-</span>zero exit status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In general, <code>R</code> is difficult in this regard if we have complicated version environments. The most advertised solution is <a href="https://rstudio.github.io/renv/articles/renv.html">renv</a>, but I have to say that even this fails often for reasons outside the <code>R</code> environment, for example, a certain <code>C</code> compiler or <code>fortran</code> compiler with certain support libraries being needed to build a <em>specific</em> version of an outdate R package. While <code>renv</code> is a great step ahead, it is not a silver bullet.</p>
</section>
<section id="dealing-with-large-files" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-large-files">Dealing with Large Files</h2>
<p>Large (data) files are complicated. Not only do they consume a lot of disk space, the real problem comes from transferring them over the internet. There may be losses along the way which invalidate the file.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check if files are Identical?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose you have a 6GB dataset and want to quickly check whether it is identical to the previous version you obtained. You don‚Äôt want to check <em>each row</em> of that dataset. Instead, you could compute the <a href="https://en.wikipedia.org/wiki/Md5sum"><code>md5sum</code></a>, which is akin to counting bits in the file in a certain kind of way and summing them up. It‚Äôs like a digital fingerprint of a file. For example to verify that <code>file_to_check.csv</code> is identical you would do on your linux/Mac terminal</p>
<pre><code>md5sum file_to_check.csv</code></pre>
<p>in both versions of the package, and verify that the result is the same. On your windows powershell you would <a href="https://serverfault.com/questions/57529/how-do-i-get-the-md5-of-a-file-on-windows">do this</a></p>
<pre><code>CertUtil -hashfile file_to_check.csv MD5</code></pre>
</div>
</div>
<section id="compression-of-files" class="level3">
<h3 class="anchored" data-anchor-id="compression-of-files">Compression of files</h3>
<ul>
<li>There are several compression technologies out there, indicated by various filename endings <code>.zip</code>, <code>.tar</code>, <code>.gz</code>, <code>.7z</code> etc.</li>
<li></li>
</ul>
<p>There are many different facets to compression which sometimes cause problems.</p>
<ol type="1">
<li>The md5 hash of a zip file create on one machine is not necessarily identical to the md5 hash of the zip file created on another machine - <strong>despite both having the exact same content</strong>. This is because different systems use different algorithms to create the zip file.</li>
<li>For zip files larger than 4GB, the macOS default archiver utility often fails with cryptic errors.</li>
<li>a good solution is the <a href="https://sourceforge.net/projects/p7zip/"><code>p7zip</code></a> utility. Install via <code>brew install p7zip</code> and used like this: <code>7za x large_package_to_unzip.zip dest_name</code></li>
<li>We can split a zip into several smaller parts: https://superuser.com/questions/336219/how-do-i-split-a-zip-file-into-multiple-segments. For example we had to do this <a href="https://zenodo.org/records/11202896">on this package</a>.</li>
</ol>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("git@github-jpe:jpedataeditor\/jpedataeditor\.github\.io\.git");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>JPE Data Editor: <a href="jpe.dataeditor@gmail.com">jpe.dataeditor@gmail.com</a> <br> JPE Journal Office: <a href="jpe@press.uchicago.edu">jpe@press.uchicago.edu</a></p>
</div>   
    <div class="nav-footer-center">
<p>¬© <a href="https://floswald.github.io">Florian Oswald</a> 2025</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jpedataeditor">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>